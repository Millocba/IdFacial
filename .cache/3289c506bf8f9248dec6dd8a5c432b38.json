{"dependencies":[{"name":"tslib","loc":{"line":1,"column":50}},{"name":"../factories/WithFaceDetection","loc":{"line":2,"column":40}},{"name":"../mtcnn/MtcnnOptions","loc":{"line":3,"column":29}},{"name":"../ssdMobilenetv1/SsdMobilenetv1Options","loc":{"line":4,"column":38}},{"name":"../tinyFaceDetector/TinyFaceDetectorOptions","loc":{"line":5,"column":40}},{"name":"../tinyYolov2","loc":{"line":6,"column":34}},{"name":"./ComposableTask","loc":{"line":7,"column":31}},{"name":"./DetectFaceLandmarksTasks","loc":{"line":8,"column":74}},{"name":"./nets","loc":{"line":9,"column":21}},{"name":"./PredictAgeAndGenderTask","loc":{"line":10,"column":74}},{"name":"./PredictFaceExpressionsTask","loc":{"line":11,"column":80}}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DetectSingleFaceTask = exports.DetectAllFacesTask = exports.DetectFacesTaskBase = undefined;\n\nvar _tslib = require(\"tslib\");\n\nvar _WithFaceDetection = require(\"../factories/WithFaceDetection\");\n\nvar _MtcnnOptions = require(\"../mtcnn/MtcnnOptions\");\n\nvar _SsdMobilenetv1Options = require(\"../ssdMobilenetv1/SsdMobilenetv1Options\");\n\nvar _TinyFaceDetectorOptions = require(\"../tinyFaceDetector/TinyFaceDetectorOptions\");\n\nvar _tinyYolov = require(\"../tinyYolov2\");\n\nvar _ComposableTask = require(\"./ComposableTask\");\n\nvar _DetectFaceLandmarksTasks = require(\"./DetectFaceLandmarksTasks\");\n\nvar _nets = require(\"./nets\");\n\nvar _PredictAgeAndGenderTask = require(\"./PredictAgeAndGenderTask\");\n\nvar _PredictFaceExpressionsTask = require(\"./PredictFaceExpressionsTask\");\n\nvar DetectFacesTaskBase = /** @class */function (_super) {\n  (0, _tslib.__extends)(DetectFacesTaskBase, _super);\n  function DetectFacesTaskBase(input, options) {\n    if (options === void 0) {\n      options = new _SsdMobilenetv1Options.SsdMobilenetv1Options();\n    }\n    var _this = _super.call(this) || this;\n    _this.input = input;\n    _this.options = options;\n    return _this;\n  }\n  return DetectFacesTaskBase;\n}(_ComposableTask.ComposableTask);\nexports.DetectFacesTaskBase = DetectFacesTaskBase;\n\nvar DetectAllFacesTask = /** @class */function (_super) {\n  (0, _tslib.__extends)(DetectAllFacesTask, _super);\n  function DetectAllFacesTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  DetectAllFacesTask.prototype.run = function () {\n    return (0, _tslib.__awaiter)(this, void 0, void 0, function () {\n      var _a, input, options, faceDetectionFunction;\n      return (0, _tslib.__generator)(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this, input = _a.input, options = _a.options;\n            if (!(options instanceof _MtcnnOptions.MtcnnOptions)) return [3 /*break*/, 2];\n            return [4 /*yield*/, _nets.nets.mtcnn.forward(input, options)];\n          case 1:\n            return [2 /*return*/, _b.sent().map(function (result) {\n              return result.detection;\n            })];\n          case 2:\n            faceDetectionFunction = options instanceof _TinyFaceDetectorOptions.TinyFaceDetectorOptions ? function (input) {\n              return _nets.nets.tinyFaceDetector.locateFaces(input, options);\n            } : options instanceof _SsdMobilenetv1Options.SsdMobilenetv1Options ? function (input) {\n              return _nets.nets.ssdMobilenetv1.locateFaces(input, options);\n            } : options instanceof _tinyYolov.TinyYolov2Options ? function (input) {\n              return _nets.nets.tinyYolov2.locateFaces(input, options);\n            } : null;\n            if (!faceDetectionFunction) {\n              throw new Error('detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options');\n            }\n            return [2 /*return*/, faceDetectionFunction(input)];\n        }\n      });\n    });\n  };\n  DetectAllFacesTask.prototype.runAndExtendWithFaceDetections = function () {\n    var _this = this;\n    return new Promise(function (res) {\n      return (0, _tslib.__awaiter)(_this, void 0, void 0, function () {\n        var detections;\n        return (0, _tslib.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4 /*yield*/, this.run()];\n            case 1:\n              detections = _a.sent();\n              return [2 /*return*/, res(detections.map(function (detection) {\n                return (0, _WithFaceDetection.extendWithFaceDetection)({}, detection);\n              }))];\n          }\n        });\n      });\n    });\n  };\n  DetectAllFacesTask.prototype.withFaceLandmarks = function (useTinyLandmarkNet) {\n    if (useTinyLandmarkNet === void 0) {\n      useTinyLandmarkNet = false;\n    }\n    return new _DetectFaceLandmarksTasks.DetectAllFaceLandmarksTask(this.runAndExtendWithFaceDetections(), this.input, useTinyLandmarkNet);\n  };\n  DetectAllFacesTask.prototype.withFaceExpressions = function () {\n    return new _PredictFaceExpressionsTask.PredictAllFaceExpressionsTask(this.runAndExtendWithFaceDetections(), this.input);\n  };\n  DetectAllFacesTask.prototype.withAgeAndGender = function () {\n    return new _PredictAgeAndGenderTask.PredictAllAgeAndGenderTask(this.runAndExtendWithFaceDetections(), this.input);\n  };\n  return DetectAllFacesTask;\n}(DetectFacesTaskBase);\nexports.DetectAllFacesTask = DetectAllFacesTask;\n\nvar DetectSingleFaceTask = /** @class */function (_super) {\n  (0, _tslib.__extends)(DetectSingleFaceTask, _super);\n  function DetectSingleFaceTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  DetectSingleFaceTask.prototype.run = function () {\n    return (0, _tslib.__awaiter)(this, void 0, void 0, function () {\n      var faceDetections, faceDetectionWithHighestScore;\n      return (0, _tslib.__generator)(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, new DetectAllFacesTask(this.input, this.options)];\n          case 1:\n            faceDetections = _a.sent();\n            faceDetectionWithHighestScore = faceDetections[0];\n            faceDetections.forEach(function (faceDetection) {\n              if (faceDetection.score > faceDetectionWithHighestScore.score) {\n                faceDetectionWithHighestScore = faceDetection;\n              }\n            });\n            return [2 /*return*/, faceDetectionWithHighestScore];\n        }\n      });\n    });\n  };\n  DetectSingleFaceTask.prototype.runAndExtendWithFaceDetection = function () {\n    var _this = this;\n    return new Promise(function (res) {\n      return (0, _tslib.__awaiter)(_this, void 0, void 0, function () {\n        var detection;\n        return (0, _tslib.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4 /*yield*/, this.run()];\n            case 1:\n              detection = _a.sent();\n              return [2 /*return*/, res(detection ? (0, _WithFaceDetection.extendWithFaceDetection)({}, detection) : undefined)];\n          }\n        });\n      });\n    });\n  };\n  DetectSingleFaceTask.prototype.withFaceLandmarks = function (useTinyLandmarkNet) {\n    if (useTinyLandmarkNet === void 0) {\n      useTinyLandmarkNet = false;\n    }\n    return new _DetectFaceLandmarksTasks.DetectSingleFaceLandmarksTask(this.runAndExtendWithFaceDetection(), this.input, useTinyLandmarkNet);\n  };\n  DetectSingleFaceTask.prototype.withFaceExpressions = function () {\n    return new _PredictFaceExpressionsTask.PredictSingleFaceExpressionsTask(this.runAndExtendWithFaceDetection(), this.input);\n  };\n  DetectSingleFaceTask.prototype.withAgeAndGender = function () {\n    return new _PredictAgeAndGenderTask.PredictSingleAgeAndGenderTask(this.runAndExtendWithFaceDetection(), this.input);\n  };\n  return DetectSingleFaceTask;\n}(DetectFacesTaskBase);\nexports.DetectSingleFaceTask = DetectSingleFaceTask;\n//# sourceMappingURL=DetectFacesTasks.js.map"},"hash":"54c5ac017faa908c9348a662fc893a68"}